[client]
default-character-set = utf8mb4
port = 3306
socket = /var/run/mysqld/mysqld.sock

[mysql]
default-character-set = utf8mb4
no-auto-rehash
show-warnings

[mysqld]
# Basic Settings
user = mysql
pid-file = /var/run/mysqld/mysqld.pid
socket = /var/run/mysqld/mysqld.sock
port = 3306
basedir = /usr
datadir = /var/lib/mysql
tmpdir = /tmp
lc-messages-dir = /usr/share/mysql
skip-external-locking

# Character Set Configuration for Railway QR Tracker
character-set-client-handshake = FALSE
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci
init_connect = 'SET NAMES utf8mb4'

# Connection Settings (optimized for Railway QR Tracker load)
max_connections = 500
max_user_connections = 450
thread_cache_size = 50
max_allowed_packet = 256M
connect_timeout = 10
wait_timeout = 600
interactive_timeout = 600
back_log = 150

# Buffer Settings (optimized for 100M+ components)
# Adjust these based on available RAM - recommended minimum 8GB
key_buffer_size = 256M
max_allowed_packet = 256M
table_open_cache = 4000
sort_buffer_size = 4M
read_buffer_size = 2M
read_rnd_buffer_size = 16M
myisam_sort_buffer_size = 128M
thread_cache_size = 50

# Query Cache (for repeated QR code lookups)
query_cache_size = 512M
query_cache_limit = 8M
query_cache_type = 1
query_cache_min_res_unit = 2K

# InnoDB Settings (critical for Railway QR Tracker performance)
# Buffer pool size should be 50-80% of total RAM for dedicated DB server
innodb_buffer_pool_size = 4G
innodb_buffer_pool_instances = 4
innodb_log_file_size = 512M
innodb_log_buffer_size = 64M
innodb_flush_log_at_trx_commit = 2
innodb_lock_wait_timeout = 50
innodb_file_per_table = ON
innodb_open_files = 2000

# InnoDB Performance Optimizations
innodb_io_capacity = 2000
innodb_io_capacity_max = 4000
innodb_read_io_threads = 8
innodb_write_io_threads = 8
innodb_thread_concurrency = 16
innodb_flush_method = O_DIRECT
innodb_adaptive_hash_index = ON
innodb_change_buffering = all

# Logging Configuration
log_error = /var/log/mysql/error.log
general_log = OFF
general_log_file = /var/log/mysql/mysql.log

# Slow Query Log (essential for performance monitoring)
slow_query_log = ON
slow_query_log_file = /var/log/mysql/slow.log
long_query_time = 2
log_queries_not_using_indexes = ON
log_slow_admin_statements = ON
log_slow_slave_statements = ON

# Binary Logging (for replication and backup)
log_bin = /var/log/mysql/mysql-bin.log
expire_logs_days = 10
max_binlog_size = 100M
binlog_format = ROW
binlog_cache_size = 1M
sync_binlog = 1

# Replication Settings (for scaling)
server_id = 1
gtid_mode = ON
enforce_gtid_consistency = ON
log_slave_updates = ON
relay_log_recovery = ON

# Security Settings
ssl-ca = /etc/mysql/ssl/ca-cert.pem
ssl-cert = /etc/mysql/ssl/server-cert.pem
ssl-key = /etc/mysql/ssl/server-key.pem
ssl-cipher = ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384

# Disable potentially dangerous functions
local_infile = OFF
symbolic-links = 0

# Performance Schema (for monitoring)
performance_schema = ON
performance_schema_max_table_instances = 400
performance_schema_max_table_handles = 4000
performance_schema_max_index_stat = 5000
performance_schema_max_table_lock_stat = 5000

# Table and Index Statistics
innodb_stats_on_metadata = OFF
innodb_stats_persistent = ON
innodb_stats_auto_recalc = ON

# Temporary Tables (for complex analytical queries)
tmp_table_size = 256M
max_heap_table_size = 256M

# Group Replication (for high availability)
# Uncomment and configure for production clusters
# loose-group_replication_group_name = "aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa"
# loose-group_replication_start_on_boot = OFF
# loose-group_replication_local_address = "127.0.0.1:33061"
# loose-group_replication_group_seeds = "127.0.0.1:33061"

[mysqldump]
quick
quote-names
max_allowed_packet = 256M
default-character-set = utf8mb4
single-transaction
routines
triggers
events

[mysql_safe]
log-error = /var/log/mysql/error.log
pid-file = /var/run/mysqld/mysqld.pid
nice = 0

[isamchk]
key_buffer_size = 256M
sort_buffer_size = 256M
read_buffer = 32M
write_buffer = 32M

[myisamchk]
key_buffer_size = 256M
sort_buffer_size = 256M
read_buffer = 32M
write_buffer = 32M

# Railway QR Tracker Specific Optimizations
# These settings are specifically tuned for:
# - High volume QR code scans (millions per day)
# - Large component database (100M+ records)
# - Real-time analytics queries
# - Mobile app integration with Flutter
# - Indian Railways operational requirements

# Memory allocation strategy:
# - InnoDB buffer pool: 4GB (holds most frequently accessed data)
# - Query cache: 512MB (for repeated QR lookups)
# - Sort buffers: 4MB (for analytics queries)
# - Connection buffers: Optimized for 500 concurrent connections

# Performance monitoring:
# - Slow query log enabled for queries > 2 seconds
# - Performance schema enabled for detailed monitoring
# - Binary logging for backup and replication

# Security features:
# - SSL/TLS encryption enabled
# - Local file loading disabled
# - Symbolic links disabled
# - GTID enabled for secure replication

# Scaling preparation:
# - Binary logging configured for replication
# - Group replication settings prepared
# - Partitioning support enabled
# - Read/write splitting ready
